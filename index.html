<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
	<script>
		const handleFileUpload = (selector, handler) => {
			document.addEventListener("DOMContentLoaded", () => {
				document.querySelector(selector).addEventListener("change", (event) => {
					const files = event.currentTarget.files;
					if (files.length) {
						handler(files[0]);
					}
				})
			})
		}

		handleFileUpload("#put", async (file) => {
			const {url} = await (await fetch(`sign_put?contentType=${file.type}`)).json();
			await fetch(url, {
				method: "PUT",
				body: file,
			})
		});

		handleFileUpload("#post", async (file) => {
			const data = await (await fetch("sign_post")).json();

			const formData = new FormData();
			formData.append("Content-Type", file.type);
			Object.entries(data.fields).forEach(([k, v]) => {
				formData.append(k, v);
			});
			formData.append("file", file); // must be the last one

			await fetch(data.url, {
				method: "POST",
				body: formData,
			});
		});
	</script>
</head>
<body>
	<p>Only accepts images. Try uploading something else and see it fail</p>
	<h2>PUT</h2>
	<p>accepts any size</p>
	<input id="put" type="file"/>
	<h3>POST</h3>
	<p>accepts only &lt;1MB</p>
	<input id="post" type="file"/>
	<h2>List objects</h2>
<table>
	<thead>
		<tr>
			<th>Key</th>
			<th>Last modified</th>
			<th>Size</th>
			<th>Content Type</th>
			<th>Metadata</th>
		</tr>
		<tbody>$$BUCKET_CONTENTS$$</tbody>
	</thead>
</table>
</body>
</html>
